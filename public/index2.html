<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>幸运大转盘 - 抽奖</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            color: #333;
            overflow: hidden; /* 防止页面滚动 */
        }

        .container {
            width: 90%;
            max-width: 400px; /* 限制最大宽度，适配平板等设备 */
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .turntable-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 100%; /* 保持宽高比为1:1 */
            margin: 0 auto 30px;
        }

        .turntable {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: #fdd835; /* 底色 */
            border: 8px solid #ffab00;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); /* 旋转动画 */
            display: flex; /* 用于定位奖品项 */
            justify-content: center;
            align-items: center;
            overflow: hidden; /* 防止文字溢出 */
        }

        .turntable.spinning {
            /* 旋转动画通过JS动态设置transform */
        }

        .turntable-pointer {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 30px solid #ff6b6b; /* 指针颜色 */
            top: -15px; /* 放置在轮盘上方 */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .prize-item {
            position: absolute;
            top: 0;
            left: 50%;
            width: 50%; /* 每个奖品项占据轮盘的一半宽度，便于扇形布局 */
            height: 50%; /* 每个奖品项占据轮盘的一半高度 */
            transform-origin: 0% 100%; /* 旋转中心点在轮盘中心 */
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding-left: 10px; /* 奖品文字距离中心点稍远 */
            box-sizing: border-box;
            color: #fff;
            font-size: 0.8em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            white-space: nowrap; /* 防止文字换行 */
        }

        /* 奖品项背景色 */
        .prize-item:nth-child(even) { background-color: rgba(0, 150, 136, 0.8); } /* 绿色 */
        .prize-item:nth-child(odd) { background-color: rgba(255, 87, 34, 0.8); } /* 橙色 */

        .start-button {
            background-color: #4CAF50; /* 绿色按钮 */
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, transform 0.1s ease;
            width: 80%;
            max-width: 250px;
            margin-top: 20px;
        }

        .start-button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .start-button:active {
            transform: translateY(0);
        }

        .start-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease;
        }

        .result-modal.show {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: bounceIn 0.5s ease-out;
        }

        .modal-content h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .modal-content p {
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .modal-content .close-btn {
            background-color: #ff6b6b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        .modal-content .close-btn:hover {
            background-color: #e65a5a;
        }

        /* 动画 */
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>幸运大转盘</h1>
        <div class="turntable-wrapper">
            <div class="turntable-pointer"></div>
            <div class="turntable" id="turntable">
                </div>
        </div>
        <button class="start-button" id="startButton">开始抽奖</button>
    </div>

    <div class="result-modal" id="resultModal">
        <div class="modal-content">
            <h2 id="modalTitle">恭喜您！</h2>
            <p id="modalMessage">您抽中了：**特等奖**</p>
            <button class="close-btn" id="closeModalButton">确定</button>
        </div>
    </div>

    <script>
        const prizes = [
            { id: 1, name: '一等奖', probability: 0.05 }, // 5%
            { id: 2, name: '二等奖', probability: 0.10 }, // 10%
            { id: 3, name: '三等奖', probability: 0.15 }, // 15%
            { id: 4, name: '谢谢参与', probability: 0.30 }, // 30%
            { id: 5, name: '再来一次', probability: 0.20 }, // 20%
            { id: 6, name: '优惠券', probability: 0.20 }   // 20%
        ];

        const turntable = document.getElementById('turntable');
        const startButton = document.getElementById('startButton');
        const resultModal = document.getElementById('resultModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalButton = document.getElementById('closeModalButton');

        let isSpinning = false;
        let totalAngle = 0; // 记录总旋转角度

        // 1. 动态生成奖品项
        function createPrizes() {
            const numPrizes = prizes.length;
            const anglePerPrize = 360 / numPrizes; // 每个奖品占据的角度

            prizes.forEach((prize, index) => {
                const prizeItem = document.createElement('div');
                prizeItem.classList.add('prize-item');
                // 通过旋转和skewY变换，将矩形变成扇形
                prizeItem.style.transform = `rotate(${index * anglePerPrize}deg) skewY(${90 - anglePerPrize}deg)`;
                prizeItem.style.backgroundColor = index % 2 === 0 ? 'rgba(0, 150, 136, 0.8)' : 'rgba(255, 87, 34, 0.8)';
                prizeItem.innerHTML = `<span style="display: block; transform: skewY(${-(90 - anglePerPrize)}deg) rotate(${anglePerPrize / 2}deg);">${prize.name}</span>`;
                turntable.appendChild(prizeItem);
            });
        }

        // 2. 根据概率计算最终中奖的奖品
        function getWinningPrize() {
            let randomNumber = Math.random(); // 0 到 1 之间的随机数
            let cumulativeProbability = 0;

            for (let i = 0; i < prizes.length; i++) {
                cumulativeProbability += prizes[i].probability;
                if (randomNumber <= cumulativeProbability) {
                    return prizes[i];
                }
            }
            // 兜底，理论上不会执行到这里，除非概率和不为1
            return prizes[prizes.length - 1];
        }

        // 3. 计算目标旋转角度
        function calculateTargetAngle(winningPrize) {
            const numPrizes = prizes.length;
            const anglePerPrize = 360 / numPrizes;

            // 找到中奖奖品在数组中的索引
            const winningIndex = prizes.findIndex(p => p.id === winningPrize.id);

            // 计算该奖品区域的中心角度
            // 由于奖品项是从0度开始顺时针排列，第 winningIndex 个奖品（从0开始计数）
            // 其区域的起始角度是 winningIndex * anglePerPrize
            // 区域的结束角度是 (winningIndex + 1) * anglePerPrize
            // 中心角度是 (winningIndex * anglePerPrize) + (anglePerPrize / 2)
            const targetCenterAngle = (winningIndex * anglePerPrize) + (anglePerPrize / 2);

            // 让指针指向中奖区域的中心。
            // 减去90度是因为指针默认朝上，而我们的0度是从右侧开始的，为了让指针停在中间，需要调整。
            // 还需要考虑多转几圈增加动画效果，这里至少转5圈。
            const extraSpins = 5;
            let finalAngle = 360 * extraSpins - targetCenterAngle;

            // 加上一个随机小偏移量，让每次停止的位置略有不同，看起来更自然
            finalAngle += Math.random() * (anglePerPrize * 0.8) - (anglePerPrize * 0.4); // 奖品区域内随机偏移

            return finalAngle;
        }

        // 4. 开始抽奖
        function startSpin() {
            if (isSpinning) return;
            isSpinning = true;
            startButton.disabled = true;

            const winningPrize = getWinningPrize();
            const targetAngle = calculateTargetAngle(winningPrize);

            // 更新总旋转角度
            totalAngle += targetAngle;

            turntable.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
            turntable.style.transform = `rotate(${totalAngle}deg)`;

            // 动画结束后处理结果
            turntable.addEventListener('transitionend', () => {
                isSpinning = false;
                startButton.disabled = false;
                showResultModal(winningPrize.name);
            }, { once: true }); // 确保事件只触发一次
        }

        // 5. 显示抽奖结果弹窗
        function showResultModal(prizeName) {
            modalMessage.innerHTML = `您抽中了：<strong>${prizeName}</strong>`;
            resultModal.classList.add('show');
        }

        // 6. 关闭抽奖结果弹窗
        function closeResultModal() {
            resultModal.classList.remove('show');
        }

        // 7. 事件监听
        startButton.addEventListener('click', startSpin);
        closeModalButton.addEventListener('click', closeResultModal);
        resultModal.addEventListener('click', (e) => { // 点击背景关闭
            if (e.target === resultModal) {
                closeResultModal();
            }
        });

        // 页面加载时初始化
        createPrizes();
    </script>
</body>
</html>